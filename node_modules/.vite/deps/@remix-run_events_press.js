import {
  createInteraction,
  doc,
  dom,
  events
} from "./chunk-W54O7O5R.js";

// node_modules/@remix-run/events/dist/lib/invariant.js
function invariant(assertion, message) {
  let prefix = "Invariant";
  if (assertion)
    return;
  throw new Error(message ? `${prefix}: ${message}` : prefix);
}

// node_modules/@remix-run/events/dist/interactions/press.js
function normalizeBox(box, defaultValue) {
  return box ?? defaultValue;
}
function isTargetWithinHitBox(element, event, options = {}) {
  let rect = element.getBoundingClientRect();
  let hit = normalizeBox(options.hit, 10);
  return event.clientX >= rect.left - hit && event.clientX <= rect.right + hit && event.clientY >= rect.top - hit && event.clientY <= rect.bottom + hit;
}
function isTargetWithinReleaseBox(element, event, options = {}) {
  let rect = element.getBoundingClientRect();
  let hit = normalizeBox(options.hit, 10);
  let release = normalizeBox(options.release, 10);
  let totalBox = hit + release;
  return event.clientX >= rect.left - totalBox && event.clientX <= rect.right + totalBox && event.clientY >= rect.top - totalBox && event.clientY <= rect.bottom + totalBox;
}
var dispatchedPressDownEvents = /* @__PURE__ */ new WeakSet();
var pressDown = createInteraction("pressDown", ({ dispatch, target }, options = {}) => {
  let pointerDownHandler = (e) => {
    if (e.button !== 0)
      return;
    if (isTargetWithinHitBox(target, e, options)) {
      let bubbles = !dispatchedPressDownEvents.has(e);
      if (bubbles) {
        dispatchedPressDownEvents.add(e);
      }
      dispatch({
        detail: {
          originalEvent: e,
          target,
          inputType: "pointer"
        },
        bubbles
      }, e);
    }
  };
  let keyDownHandler = (e) => {
    if ((e.key === " " || e.key === "Enter") && !e.repeat) {
      dispatch({
        detail: {
          originalEvent: e,
          target,
          inputType: "keyboard"
        }
      }, e);
    }
  };
  let pointerUpHandler = () => {
  };
  return [
    events(document, [doc.pointerdown(pointerDownHandler)]),
    events(target, [dom.keydown(keyDownHandler), pressUp(pointerUpHandler)])
  ];
});
var dispatchedPressUpEvents = /* @__PURE__ */ new WeakSet();
var pressUp = createInteraction("pressUp", ({ dispatch, target }, options = {}) => {
  let pointerUpHandler = (e) => {
    if (isTargetWithinReleaseBox(target, e, options)) {
      let bubbles = !dispatchedPressUpEvents.has(e);
      if (bubbles) {
        dispatchedPressUpEvents.add(e);
      }
      dispatch({
        detail: {
          originalEvent: e,
          target,
          inputType: "pointer"
        },
        bubbles
      }, e);
    }
  };
  let keyUpHandler = (e) => {
    if (e.key === " " || e.key === "Enter") {
      dispatch({
        detail: {
          originalEvent: e,
          target,
          inputType: "keyboard"
        }
      }, e);
    }
  };
  return [
    events(document, [doc.pointerup(pointerUpHandler)]),
    events(target, [dom.keyup(keyUpHandler)])
  ];
});
var longPress = createInteraction("longPress", ({ dispatch, target }, options = {}) => {
  let timer;
  let startDetail = null;
  let activePointers = /* @__PURE__ */ new Set();
  let clearTimer = () => {
    window.clearTimeout(timer);
  };
  let startHandler = (event) => {
    startDetail = event.detail;
    clearTimer();
    timer = window.setTimeout(() => {
      invariant(startDetail);
      dispatch({ detail: startDetail });
    }, options.delay ?? 500);
    if (startDetail && startDetail.inputType === "pointer") {
      activePointers.add(startDetail.originalEvent.pointerId);
    }
  };
  let endHandler = () => {
    clearTimer();
    activePointers.clear();
  };
  let pointerMoveHandler = (e) => {
    if (activePointers.has(e.pointerId)) {
      if (!isTargetWithinReleaseBox(target, e, options)) {
        clearTimer();
        activePointers.delete(e.pointerId);
      }
    }
  };
  return [
    events(target, [pressDown(startHandler, options), pressUp(endHandler, options)]),
    events(document, [doc.pointermove(pointerMoveHandler)]),
    clearTimer
  ];
});
var dispatchedPressEvents = /* @__PURE__ */ new WeakSet();
var press = createInteraction("press", ({ dispatch, target }, options = {}) => {
  let pressing = false;
  let longPressed = false;
  let startDetail = null;
  let startHandler = (event) => {
    pressing = true;
    longPressed = false;
    startDetail = event.detail;
  };
  let longPressHandler = () => {
    longPressed = true;
    pressing = false;
  };
  let endHandler = () => {
    if (pressing && !longPressed) {
      invariant(startDetail);
      let originalEvent = startDetail.originalEvent;
      let bubbles = !dispatchedPressEvents.has(originalEvent);
      if (bubbles) {
        dispatchedPressEvents.add(originalEvent);
      }
      dispatch({ detail: startDetail, bubbles }, originalEvent);
    }
    pressing = false;
  };
  return events(target, [
    pressDown(startHandler, options),
    longPress(longPressHandler, options),
    pressUp(endHandler, options)
  ]);
});
var outerPressDown = createInteraction("outerPressDown", ({ dispatch, target }, options = {}) => {
  return events(document, [
    doc.pointerdown((event) => {
      if (target instanceof Node && event.target instanceof Node && !target.contains(event.target) && !isTargetWithinHitBox(target, event, options)) {
        dispatch({
          bubbles: false,
          detail: { originalEvent: event }
        }, event);
      }
    })
  ]);
});
var outerPressUp = createInteraction("outerPressUp", ({ dispatch, target }, options = {}) => {
  let pressed = false;
  let startEvent = null;
  return [
    events(target, [
      outerPressDown((event) => {
        pressed = true;
        startEvent = event.detail.originalEvent;
      }, options)
    ]),
    events(document, [
      doc.pointerup((event) => {
        if (pressed && target instanceof Node && event.target instanceof Node && !target.contains(event.target) && !isTargetWithinHitBox(target, event, options)) {
          invariant(startEvent);
          dispatch({
            bubbles: false,
            detail: { originalEvent: startEvent }
          }, startEvent);
        }
        pressed = false;
      })
    ])
  ];
});
var outerPress = createInteraction("outerPress", ({ dispatch, target }, options = {}) => {
  let pressing = false;
  let startEvent = null;
  let startHandler = (event) => {
    pressing = true;
    startEvent = event.detail.originalEvent;
  };
  let endHandler = () => {
    if (pressing) {
      invariant(startEvent);
      dispatch({
        bubbles: false,
        detail: { originalEvent: startEvent }
      }, startEvent);
    }
    pressing = false;
  };
  return events(target, [
    outerPressDown(startHandler, options),
    outerPressUp(endHandler, options)
  ]);
});
export {
  longPress,
  outerPress,
  outerPressDown,
  outerPressUp,
  press,
  pressDown,
  pressUp
};
//# sourceMappingURL=@remix-run_events_press.js.map
